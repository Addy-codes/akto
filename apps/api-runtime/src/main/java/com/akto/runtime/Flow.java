package com.akto.runtime;

import com.akto.DaoInit;
import com.akto.dao.RelationshipDao;
import com.akto.dao.SingleTypeInfoDao;
import com.akto.dao.context.Context;
import com.akto.dto.Markov;
import com.akto.dto.Relationship;
import com.akto.dto.type.SingleTypeInfo;
import com.akto.parsers.HttpCallParser;
import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ArrayNode;
import com.mongodb.BasicDBObject;
import com.mongodb.ConnectionString;
import com.mongodb.client.model.Filters;
import org.bson.conversions.Bson;

import java.io.*;
import java.util.*;

public class Flow {
    MarkovSync markovSync;
    RelationshipSync relationshipSync;
    String userIdentifierName;

    public Flow(int relationship_user_thresh, int relationship_counter_thresh, int relationship_last_sync_thresh,
                int markov_user_thresh, int markov_counter_thresh, int markov_last_sync_thresh, String userIdentifierName) {
        this.userIdentifierName = userIdentifierName;
        this.markovSync = new MarkovSync(markov_user_thresh ,markov_counter_thresh, markov_last_sync_thresh);
        this.relationshipSync = new RelationshipSync(relationship_user_thresh, relationship_counter_thresh,
                relationship_last_sync_thresh);
    }

    public void init(List<HttpCallParser.HttpResponseParams> httpResponseParams) throws Exception{
        markovSync.buildMarkov(httpResponseParams, userIdentifierName);
        relationshipSync.init(httpResponseParams, userIdentifierName);
    }

    public static String getUserIdentifier(String name, HttpCallParser.HttpRequestParams requestParams) throws Exception {
        Map<String,List<String>> headers = requestParams.getHeaders();
        List<String> l = headers.get(name);
        if (l == null) throw new Exception("Header doesn't exist");
        if (l.size() < 1) throw new Exception("User identifier headers list is empty");
        String userIdentifier = l.get(0);
        if (userIdentifier != null) return userIdentifier;
        throw new Exception("User identifier not found");
    }

    public static String calculateTodayKey() {
        int date = Context.convertEpochToDateInt(Context.now(), "UTC");
        return date + "";
    }


    public static void main(String[] args) throws Exception {
        String mongoURI = "mongodb://write_ops:write_ops@cluster0-shard-00-00.yg43a.mongodb.net:27017,cluster0-shard-00-01.yg43a.mongodb.net:27017,cluster0-shard-00-02.yg43a.mongodb.net:27017/myFirstDatabase?ssl=true&replicaSet=atlas-qd3mle-shard-0&authSource=admin&retryWrites=true&w=majority";
        DaoInit.init(new ConnectionString(mongoURI));
        Context.accountId.set(77);
        HttpCallParser h =  new HttpCallParser("access-token", 10,10,10);
        List<String> kk = new ArrayList<>();

        FileInputStream fstream = new FileInputStream("/home/avneesh/Desktop/akto-security/api-runtime/src/resources/log_check.json");
        BufferedReader br = new BufferedReader(new InputStreamReader(fstream));
        String strLine;
        while ((strLine = br.readLine()) != null)   {
            if (strLine.length() < 10) {
                continue;
            }
            kk.add(strLine);
        }
        fstream.close();

//        kk.add("{\"path\":\"/api/today\",\"requestHeaders\":{\"Origin\":\"http://localhost:8080\",\"Cookie\":\"refreshToken=eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJpYW1hdm5lZXNoLmhvdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcyMDI5LCJleHAiOjE2MzUwNTg0Mjl9.m8qLOYpiBbfwWL0B8eoJ4wSK6XHNqMFQG9d_EETh51S8TuZRk8HUSW04gGnB87EKLMIcubE0XXyTXLIEYMw-_LUx3UOLKYhnqTnMYzJxM24IbWhIHdaRY9wY6WnWuM_Wfk7HcAgfd7nJ9pwmPYXDwANqH12dURivV3zgf0FaCvaHHJhEvIvu0l6cMihAA1z0qIiI0ipfuJgBEvyQmnkjhsA-s4pNhMk0UQqUb1yO3tdvEasRfD_QriC3eSHO6lHxMfYPHtblmsgwkf3kAh6YT3giZjIy7UxOZJiX0ZbmBg7qds_MuKnVf4q5YPnSJ3_YPQ3nHVu63Sjx22m6cfBYqw; JSESSIONID=node01mye4vub29fpvsi440zg26hsq0.node0\",\"Accept\":\"application/json, text/plain, */*\",\"Access-Control-Allow-Origin\":\"*\",\"Connection\":\"keep-alive\",\"User-Agent\":\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36\",\"Referer\":\"http://localhost:8080/dashboard/today\",\"Sec-Fetch-Site\":\"same-origin\",\"Sec-Fetch-Dest\":\"empty\",\"Host\":\"localhost:8080\",\"access-token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImFua2l0YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMTAsImV4cCI6MTYzNDk3NDAxMH0.ZG2GaHZlu74VKotqUpWlknPP5vXBIdjYFPk5zU9t-g7l6bndHls4aiouBwiO45JrIfLTtm3-u8xdBFYi5tugth4sN06Hpic8KPtHRHmOOdRnZjYj_5wfG2ZzcctvZticT2RTpYeNqS1zwQ0X6hQ2OolQKKPi9zxSHRNKEqExYUebx-GZOnHfGJ7xlZqFmpt5hhdbv0T18OPRcpJlgU5yXVFv9_Hz-9u2UmserphrpTBjDXaMBxP7T44paSmDsArElLJrhvCuegeHvDw0I94EE8C3_7to017VKVAbXsYkAx4txXa7ETIdgLe9YkpSyz_IkXYM3yYazNrjoTZx3lY2Ng\",\"Accept-Encoding\":\"gzip, deflate, br\",\"Sec-Fetch-Mode\":\"cors\",\"sec-ch-ua\":\"\\\"Chromium\\\";v=\\\"95\\\", \\\";Not A Brand\\\";v=\\\"99\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"Linux\\\"\",\"Accept-Language\":\"en-GB,en-US;q=0.9,en;q=0.8\",\"Content-Length\":\"2\",\"account\":\"222222\",\"Content-Type\":\"application/json\"},\"responseHeaders\":{\"Access-Token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImlhbWF2bmVlc2guaG90YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMzEsImV4cCI6MTYzNDk3NDAzMX0.I6s6PusUJby0bDqBHFQBggPSXft7nsR-sQSpp5L6lUCEZRtesvymyeoPN2WQiBtHYJJ4lnCIfMJo9QG9CF9KqxK5OeGtA_jC68EFxQLnAXCX6jnmY2nJap_CWFh3BJrJ1x7UJ2fwZqK1NcmwffvmQvF1LI0jwv0hCBowikPCegKAo7nB3vLrDDIjrek23atQXd7sydxW-pOXegg-JalOX0ASPXm_YwLTeORVZxRtvEP_xQl33pHmFCo3tuoJOnzuxJExzYS5XmS03D49vCgyVc2rbcfzn-0ipHHscYhoBr3JTXwwETvOGOhOqFV45jK60Xi7xrS8D7yqZxZ0UKu0gw\",\"Content-Length\":\"4367\",\"Date\":\"Sat, 23 Oct 2021 07:12:11 GMT\",\"Content-Type\":\"application/json;charset=utf-8\"},\"method\":\"POST\",\"requestPayload\":{},\"responsePayload\":{\"healthyMetrics\":[{\"id\":1625725069,\"name\":\"Transactions\",\"ownerName\":\"Ankita Gupta\",\"owner\":1618123456,\"currValue\":3573.0,\"targetValue\":4516.129,\"status\":0,\"favourite\":false,\"trackingPeriod\":1,\"dashboardName\":\"Production\",\"dashboardId\":1625226749,\"pendingActionItems\":[]}],\"needAttentionMetrics\":[{\"id\":1624982568,\"name\":\"Customers\",\"ownerName\":\"Ankita Gupta\",\"owner\":1618123456,\"currValue\":55.0,\"targetValue\":140.0,\"status\":1,\"favourite\":false,\"trackingPeriod\":1,\"dashboardName\":\"Production\",\"dashboardId\":1625226749,\"pendingActionItems\":[{\"id\":1624988674,\"metrics_meta_id\":1624982568,\"creationDate\":1624988674,\"dueDate\":1624968019,\"author_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Send email to new leads\",\"additional_info\":\"\",\"comments_count\":8,\"watchers_count\":1,\"current_status\":1,\"unread\":true,\"last_updated_date\":1634714223,\"userMentioned\":false},{\"id\":1624988768,\"metrics_meta_id\":1624982568,\"creationDate\":1624988768,\"dueDate\":1624968019,\"author_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Follow up on previously churned accounts\",\"additional_info\":\"\",\"comments_count\":2,\"watchers_count\":1,\"current_status\":1,\"unread\":true,\"last_updated_date\":1624988768,\"userMentioned\":false},{\"id\":1624989131,\"metrics_meta_id\":1624982568,\"creationDate\":1624989131,\"dueDate\":1627560019,\"author_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"owner_info\":{\"id\":1618123456,\"login\":\"ankita@gmail.com\",\"name\":\"Ankita Gupta\"},\"priority\":0,\"description\":\"Help account manager onboard new customers\",\"additional_info\":\"\",\"comments_count\":4,\"watchers_count\":3,\"current_status\":0,\"unread\":true,\"last_updated_date\":1624989131,\"userMentioned\":false},{\"id\":1625000287,\"metrics_meta_id\":1624982568,\"creationDate\":1625000287,\"dueDate\":1625239324,\"author_info\":{\"id\":1618123456,\"login\":\"ankita@gmail.com\",\"name\":\"Ankita Gupta\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Explore new market segment\",\"additional_info\":\"\",\"comments_count\":1,\"watchers_count\":1,\"current_status\":1,\"unread\":true,\"last_updated_date\":1625000287,\"userMentioned\":false},{\"id\":1625000437,\"metrics_meta_id\":1624982568,\"creationDate\":1625000437,\"dueDate\":1624375324,\"author_info\":{\"id\":1618123456,\"login\":\"ankita@gmail.com\",\"name\":\"Ankita Gupta\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Write more blogs explaining our use case\",\"additional_info\":\"\",\"comments_count\":1,\"watchers_count\":1,\"current_status\":0,\"unread\":true,\"last_updated_date\":1625000437,\"userMentioned\":false},{\"id\":1625000744,\"metrics_meta_id\":1624982568,\"creationDate\":1625000744,\"dueDate\":1624375324,\"author_info\":{\"id\":1618123456,\"login\":\"ankita@gmail.com\",\"name\":\"Ankita Gupta\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Follow up with marketing team\",\"additional_info\":\"\",\"comments_count\":2,\"watchers_count\":1,\"current_status\":0,\"unread\":true,\"last_updated_date\":1625000744,\"userMentioned\":false},{\"id\":1625001002,\"metrics_meta_id\":1624982568,\"creationDate\":1625001002,\"dueDate\":1625325724,\"author_info\":{\"id\":1618123456,\"login\":\"ankita@gmail.com\",\"name\":\"Ankita Gupta\"},\"owner_info\":{\"id\":1612899544,\"login\":\"iamavneesh.hota@gmail.com\",\"name\":\"Avneesh Hota\"},\"priority\":0,\"description\":\"Meeting with Youtube ads team\",\"additional_info\":\"\",\"comments_count\":2,\"watchers_count\":1,\"current_status\":0,\"unread\":true,\"last_updated_date\":1625001002,\"userMentioned\":false},{\"id\":1634714355,\"metrics_meta_id\":1624982568,\"creationDate\":1634714355,\"dueDate\":1635359399,\"author_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"},\"owner_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"},\"priority\":0,\"description\":\"action 1\",\"additional_info\":\"<h1>hello</h1>\",\"comments_count\":0,\"watchers_count\":0,\"current_status\":0,\"unread\":true,\"last_updated_date\":1634714355,\"userMentioned\":false}]}],\"overdueActionItems\":null,\"pendingActionItems\":null},\"ip\":\"[0:0:0:0:0:0:0:1]\",\"time\":1634973135,\"contentType\":\"application/json;charset=utf-8\",\"cookies\":[{\"name\":\"refreshToken\",\"value\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJpYW1hdm5lZXNoLmhvdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcyMDI5LCJleHAiOjE2MzUwNTg0Mjl9.m8qLOYpiBbfwWL0B8eoJ4wSK6XHNqMFQG9d_EETh51S8TuZRk8HUSW04gGnB87EKLMIcubE0XXyTXLIEYMw-_LUx3UOLKYhnqTnMYzJxM24IbWhIHdaRY9wY6WnWuM_Wfk7HcAgfd7nJ9pwmPYXDwANqH12dURivV3zgf0FaCvaHHJhEvIvu0l6cMihAA1z0qIiI0ipfuJgBEvyQmnkjhsA-s4pNhMk0UQqUb1yO3tdvEasRfD_QriC3eSHO6lHxMfYPHtblmsgwkf3kAh6YT3giZjIy7UxOZJiX0ZbmBg7qds_MuKnVf4q5YPnSJ3_YPQ3nHVu63Sjx22m6cfBYqw\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false},{\"name\":\"JSESSIONID\",\"value\":\"node01mye4vub29fpvsi440zg26hsq0.node0\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false}],\"statusCode\":200}");
//        kk.add("{\"path\":\"/api/actionItemActivities\",\"requestHeaders\":{\"Origin\":\"http://localhost:8080\",\"Cookie\":\"refreshToken=eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJhbmtpdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcxMTMxLCJleHAiOjE2MzUwNTc1MzF9.Ph4Jv-fdggwvnbdVViD9BWUReYL0dVfVGuMRz4d2oZNnYzWV0JCmjpB68p6k0yyPPua_yagIWVZf_oYH9PUgS7EuaPYR-Vg6uxKR1HuXRA6wb8Xf4RPoFjJYkhWoYmv38V9Cz2My9U85wgGHGZXEufu8ubrFmIfOP6-A39M4meNGw48f5oOz8V337SX45uPc6jE0EfmM4l9EbqFFCF0lRXbMMzn-ijsyXxLkI5npWnqtW3PAHC2Rs3FV40tkRqHYF-WM6SzyHLBh6bVeyeOsFRBoEjv-zFh8yrYnT6OvCa6jII2A6uj4MQ2k11-5bDBhfVPVc4hEQz37H_DWwtf23g; JSESSIONID=node0bfl3ki5qt830qvbet5pb11hb1.node0\",\"Accept\":\"application/json, text/plain, */*\",\"Access-Control-Allow-Origin\":\"*\",\"Connection\":\"keep-alive\",\"User-Agent\":\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36\",\"Referer\":\"http://localhost:8080/dashboard/actions/1624988030\",\"Sec-Fetch-Site\":\"same-origin\",\"Sec-Fetch-Dest\":\"empty\",\"Host\":\"localhost:8080\",\"access-token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImFua2l0YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMTAsImV4cCI6MTYzNDk3NDAxMH0.ZG2GaHZlu74VKotqUpWlknPP5vXBIdjYFPk5zU9t-g7l6bndHls4aiouBwiO45JrIfLTtm3-u8xdBFYi5tugth4sN06Hpic8KPtHRHmOOdRnZjYj_5wfG2ZzcctvZticT2RTpYeNqS1zwQ0X6hQ2OolQKKPi9zxSHRNKEqExYUebx-GZOnHfGJ7xlZqFmpt5hhdbv0T18OPRcpJlgU5yXVFv9_Hz-9u2UmserphrpTBjDXaMBxP7T44paSmDsArElLJrhvCuegeHvDw0I94EE8C3_7to017VKVAbXsYkAx4txXa7ETIdgLe9YkpSyz_IkXYM3yYazNrjoTZx3lY2Ng\",\"Accept-Encoding\":\"gzip, deflate, br\",\"Sec-Fetch-Mode\":\"cors\",\"sec-ch-ua\":\"\\\"Chromium\\\";v=\\\"95\\\", \\\";Not A Brand\\\";v=\\\"99\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"Linux\\\"\",\"Accept-Language\":\"en-GB,en-US;q=0.9,en;q=0.8\",\"Content-Length\":\"29\",\"account\":\"222222\",\"Content-Type\":\"application/json\"},\"responseHeaders\":{\"Access-Token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImFua2l0YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMTAsImV4cCI6MTYzNDk3NDAxMH0.ZG2GaHZlu74VKotqUpWlknPP5vXBIdjYFPk5zU9t-g7l6bndHls4aiouBwiO45JrIfLTtm3-u8xdBFYi5tugth4sN06Hpic8KPtHRHmOOdRnZjYj_5wfG2ZzcctvZticT2RTpYeNqS1zwQ0X6hQ2OolQKKPi9zxSHRNKEqExYUebx-GZOnHfGJ7xlZqFmpt5hhdbv0T18OPRcpJlgU5yXVFv9_Hz-9u2UmserphrpTBjDXaMBxP7T44paSmDsArElLJrhvCuegeHvDw0I94EE8C3_7to017VKVAbXsYkAx4txXa7ETIdgLe9YkpSyz_IkXYM3yYazNrjoTZx3lY2Ng\",\"Content-Length\":\"685\",\"Date\":\"Sat, 23 Oct 2021 07:12:33 GMT\",\"Content-Type\":\"application/json;charset=utf-8\"},\"method\":\"POST\",\"requestPayload\":{\"action_item_id\":1624988030},\"responsePayload\":[{\"comment\":\"<p>This is where we started :)</p>\",\"edited_comments_history\":[],\"follow_up\":false,\"follow_up_done\":false,\"mentioned_users\":[],\"replies_count\":0,\"id\":1634669898,\"parent_id\":1624988030,\"parent_type\":\"action_item\",\"timestamp\":1634669898,\"activity_type\":\"comment\",\"author_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"}},{\"field\":\"description\",\"delta\":{\"old_value\":\"Start new FB ad campaign\",\"new_value\":\"Start new FB ad campaign asdf\"},\"id\":1634712673,\"parent_id\":1624988030,\"parent_type\":\"action_item\",\"timestamp\":1634712673,\"activity_type\":\"action_item_update_info\",\"author_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"}}],\"ip\":\"[0:0:0:0:0:0:0:1]\",\"time\":1634973155,\"contentType\":\"application/json;charset=utf-8\",\"cookies\":[{\"name\":\"refreshToken\",\"value\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJhbmtpdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcxMTMxLCJleHAiOjE2MzUwNTc1MzF9.Ph4Jv-fdggwvnbdVViD9BWUReYL0dVfVGuMRz4d2oZNnYzWV0JCmjpB68p6k0yyPPua_yagIWVZf_oYH9PUgS7EuaPYR-Vg6uxKR1HuXRA6wb8Xf4RPoFjJYkhWoYmv38V9Cz2My9U85wgGHGZXEufu8ubrFmIfOP6-A39M4meNGw48f5oOz8V337SX45uPc6jE0EfmM4l9EbqFFCF0lRXbMMzn-ijsyXxLkI5npWnqtW3PAHC2Rs3FV40tkRqHYF-WM6SzyHLBh6bVeyeOsFRBoEjv-zFh8yrYnT6OvCa6jII2A6uj4MQ2k11-5bDBhfVPVc4hEQz37H_DWwtf23g\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false},{\"name\":\"JSESSIONID\",\"value\":\"node0bfl3ki5qt830qvbet5pb11hb1.node0\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false}],\"statusCode\":200}");
//        kk.add("{\"path\":\"/api/actionItem\",\"requestHeaders\":{\"Origin\":\"http://localhost:8080\",\"Cookie\":\"refreshToken=eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJhbmtpdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcxMTMxLCJleHAiOjE2MzUwNTc1MzF9.Ph4Jv-fdggwvnbdVViD9BWUReYL0dVfVGuMRz4d2oZNnYzWV0JCmjpB68p6k0yyPPua_yagIWVZf_oYH9PUgS7EuaPYR-Vg6uxKR1HuXRA6wb8Xf4RPoFjJYkhWoYmv38V9Cz2My9U85wgGHGZXEufu8ubrFmIfOP6-A39M4meNGw48f5oOz8V337SX45uPc6jE0EfmM4l9EbqFFCF0lRXbMMzn-ijsyXxLkI5npWnqtW3PAHC2Rs3FV40tkRqHYF-WM6SzyHLBh6bVeyeOsFRBoEjv-zFh8yrYnT6OvCa6jII2A6uj4MQ2k11-5bDBhfVPVc4hEQz37H_DWwtf23g; JSESSIONID=node0bfl3ki5qt830qvbet5pb11hb1.node0\",\"Accept\":\"application/json, text/plain, */*\",\"Access-Control-Allow-Origin\":\"*\",\"Connection\":\"keep-alive\",\"User-Agent\":\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36\",\"Referer\":\"http://localhost:8080/dashboard/actions/1624988030\",\"Sec-Fetch-Site\":\"same-origin\",\"Sec-Fetch-Dest\":\"empty\",\"Host\":\"localhost:8080\",\"access-token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImFua2l0YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMTAsImV4cCI6MTYzNDk3NDAxMH0.ZG2GaHZlu74VKotqUpWlknPP5vXBIdjYFPk5zU9t-g7l6bndHls4aiouBwiO45JrIfLTtm3-u8xdBFYi5tugth4sN06Hpic8KPtHRHmOOdRnZjYj_5wfG2ZzcctvZticT2RTpYeNqS1zwQ0X6hQ2OolQKKPi9zxSHRNKEqExYUebx-GZOnHfGJ7xlZqFmpt5hhdbv0T18OPRcpJlgU5yXVFv9_Hz-9u2UmserphrpTBjDXaMBxP7T44paSmDsArElLJrhvCuegeHvDw0I94EE8C3_7to017VKVAbXsYkAx4txXa7ETIdgLe9YkpSyz_IkXYM3yYazNrjoTZx3lY2Ng\",\"Accept-Encoding\":\"gzip, deflate, br\",\"Sec-Fetch-Mode\":\"cors\",\"sec-ch-ua\":\"\\\"Chromium\\\";v=\\\"95\\\", \\\";Not A Brand\\\";v=\\\"99\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"Linux\\\"\",\"Accept-Language\":\"en-GB,en-US;q=0.9,en;q=0.8\",\"Content-Length\":\"29\",\"account\":\"222222\",\"Content-Type\":\"application/json\"},\"responseHeaders\":{\"Access-Token\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoibG9naW4iLCJzaWduZWRVcCI6InRydWUiLCJ1c2VybmFtZSI6ImFua2l0YUBnbWFpbC5jb20iLCJpYXQiOjE2MzQ5NzMxMTAsImV4cCI6MTYzNDk3NDAxMH0.ZG2GaHZlu74VKotqUpWlknPP5vXBIdjYFPk5zU9t-g7l6bndHls4aiouBwiO45JrIfLTtm3-u8xdBFYi5tugth4sN06Hpic8KPtHRHmOOdRnZjYj_5wfG2ZzcctvZticT2RTpYeNqS1zwQ0X6hQ2OolQKKPi9zxSHRNKEqExYUebx-GZOnHfGJ7xlZqFmpt5hhdbv0T18OPRcpJlgU5yXVFv9_Hz-9u2UmserphrpTBjDXaMBxP7T44paSmDsArElLJrhvCuegeHvDw0I94EE8C3_7to017VKVAbXsYkAx4txXa7ETIdgLe9YkpSyz_IkXYM3yYazNrjoTZx3lY2Ng\",\"Content-Length\":\"599\",\"Date\":\"Sat, 23 Oct 2021 07:12:33 GMT\",\"Content-Type\":\"application/json;charset=utf-8\"},\"method\":\"POST\",\"requestPayload\":{\"action_item_id\":1624988030},\"responsePayload\":{\"id\":1624988030,\"metrics_info\":{\"metric_meta_id\":1624910181,\"name\":\"New Leads\",\"description\":\"this is some dummy description\",\"priority\":0,\"value\":111,\"health\":0},\"action_item\":{\"id\":1624988030,\"creationDate\":1624988030,\"dueDate\":1625227219,\"author_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"},\"owner_info\":{\"id\":1612899590,\"login\":\"ankush@gmail.com\",\"name\":\"Ankush Jain\"},\"priority\":0,\"description\":\"Start new FB ad campaign asdf\",\"additional_info\":\"\",\"comments_count\":4,\"watchers_count\":1,\"current_status\":0,\"unread\":true,\"userMentioned\":false},\"watching_preference\":0},\"ip\":\"[0:0:0:0:0:0:0:1]\",\"time\":1634973157,\"contentType\":\"application/json;charset=utf-8\",\"cookies\":[{\"name\":\"refreshToken\",\"value\":\"eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJBa3RvIiwic3ViIjoicmVmcmVzaFRva2VuIiwic2lnbmVkVXAiOiJ0cnVlIiwidXNlcm5hbWUiOiJhbmtpdGFAZ21haWwuY29tIiwiaWF0IjoxNjM0OTcxMTMxLCJleHAiOjE2MzUwNTc1MzF9.Ph4Jv-fdggwvnbdVViD9BWUReYL0dVfVGuMRz4d2oZNnYzWV0JCmjpB68p6k0yyPPua_yagIWVZf_oYH9PUgS7EuaPYR-Vg6uxKR1HuXRA6wb8Xf4RPoFjJYkhWoYmv38V9Cz2My9U85wgGHGZXEufu8ubrFmIfOP6-A39M4meNGw48f5oOz8V337SX45uPc6jE0EfmM4l9EbqFFCF0lRXbMMzn-ijsyXxLkI5npWnqtW3PAHC2Rs3FV40tkRqHYF-WM6SzyHLBh6bVeyeOsFRBoEjv-zFh8yrYnT6OvCa6jII2A6uj4MQ2k11-5bDBhfVPVc4hEQz37H_DWwtf23g\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false},{\"name\":\"JSESSIONID\",\"value\":\"node0bfl3ki5qt830qvbet5pb11hb1.node0\",\"comment\":null,\"domain\":null,\"maxAge\":-1,\"path\":null,\"secure\":false,\"version\":0,\"httpOnly\":false}],\"statusCode\":200}");

        List<HttpCallParser.HttpResponseParams> hh = new ArrayList<>();
        for (String p: kk) {
            HttpCallParser.HttpResponseParams httpResponseParams = h.parseKafkaMessage(p);
            hh.add(httpResponseParams);
        }

//        Flow flow = new Flow(hh.size(),30,0);
//        flow.init(hh, "access-token");

    }



}
