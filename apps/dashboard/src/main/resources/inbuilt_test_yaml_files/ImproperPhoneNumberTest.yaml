id: IMPROPER_PHONE_NUMBER_TEST
info:
  name: Improper phone number test
  description: Attacker can change the data type to cause unintended behaviors or unhandled edge cases
  details: >
    Parameters in a different data type than found/expected were send in
    the attack request and the server responded with 2XX [valid request] or 500
    [Internal server error] response.The 2XX response in an invalid request
    signifies that the server accepts the request in an unexpected format, such
    as an array, null values, values in a different data type (integer to
    string), or just really large values.  An attacker can exploit this behavior by sending multiple values,
    including the attacker's values, which may then be processed by the server.
    The 500 response suggests that the server had not expected these values and
    has encountered an unhandled error. This is significant since these requests
    may lead to a possible DOS or unexpected downtime since they essentially
    break the server and force it to restart. Ideally, in such a scenario, the
    server should respond with a 4XX error code. This signifies that the server
    handles the unexpected types gracefully. <br><br>
  impact: Server accepting invalid types may lead the hacker to pass their own
    values leading to parameter pollution type of attack and the server not
    handling invalid types may lead it to break thus resulting in possible DOS.
  category:
    name: IIV
    shortName: IIV
    displayName: Improper Input Validation (IIV)
  subCategory: IMPROPER_PHONE_NUMBER_TEST
  severity: LOW
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - https://cwe.mitre.org/data/definitions/20.html
    - https://hackerone.com/reports/767458

api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  or:
    - request_payload:
        for_one:
          key:
            contains_either:
              - phone
            extract: keyVar
          value:
            regex: ^(?:\D?(\d{3})\D?\D?(\d{3})\D?(\d{4})|(?:\s+|)((0|(?:(\+|)91))(?:\s|-)*(?:(?:\d(?:\s|-)*\d{9})|(?:\d{2}(?:\s|-)*\d{8})|(?:\d{3}(?:\s|-)*\d{7})|\d{10}))(?:\s+|))$
            extract: valueVar
    - query_param:
        for_one:
          key:
            contains_either:
              - phone
            extract: keyVar
          value:
            regex: ^(?:\D?(\d{3})\D?\D?(\d{3})\D?(\d{4})|(?:\s+|)((0|(?:(\+|)91))(?:\s|-)*(?:(?:\d(?:\s|-)*\d{9})|(?:\d{2}(?:\s|-)*\d{8})|(?:\d{3}(?:\s|-)*\d{7})|\d{10}))(?:\s+|))$
            extract: valueVar

wordLists:
  valueVars:
  - 9876543210987654321098765432109876543210
  - -9876543210987654321098765432109876543210

execute:
  type: single
  requests:
  - req:
    - modify_body_param:
        keyVar: ${valueVars}
    - modify_query_param:
        keyVar: ${valueVars}

validate:
  or:
    - response_code:
        or:
        - eq: 500
        - eq: 503
    - response_code:
        gte: 200
        lt: 300